<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>📊 i-GOV Feedback Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
 <style>
  /* --- GLOBAL STYLES & VARIABLES --- */
  #officeSelect {
    height: 40px;
    width: 400px;
    font-size: 16px;
    padding: 5px;
  }

   body {
    margin: 0;
    font-family: Arial, sans-serif;
  }

  /* --- HAMBURGER MENU --- */
   .hamburger {
    font-size: 30px;
    cursor: pointer;
    user-select: none;
  }

  .sidebar {
    position: fixed;
    top: 0; left: -250px; /* hidden by default */
    width: 250px;
    height: 100%;
    background: #333;
    color: white;
    overflow-y: auto;
    transition: left 0.3s ease;
    padding-top: 60px;
    z-index: 1000;
  }

  .sidebar.active {
    left: 0;
  }

  .sidebar ul {
    list-style: none;
    padding: 0;
  }

  .sidebar ul li {
    padding: 15px 20px;
    border-bottom: 1px solid #444;
  }

  .sidebar ul li a {
    color: rgb(0, 0, 0);
    text-decoration: none;
    display: block;
  }

  .sidebar ul li a:hover {
    background: #3276ab;
  }

  .overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
    z-index: 999;
  }

  .overlay.active {
    opacity: 1;
    visibility: visible;
  }
/* Basic styles for hamburger */
.hamburger-container {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1001;
  cursor: pointer;
  font-size: 30px;
  user-select: none;
}

/* Sidebar styles */
.sidebar {
  position: fixed;
  top: 0;
  left: -250px; /* hidden initially off-screen */
  width: 250px;
  height: 100vh;
  background-color: #333;
  color: white;
  padding: 20px;
  box-shadow: 2px 0 8px rgba(0,0,0,0.3);
  transition: left 0.3s ease;
  z-index: 1000;
}

/* Sidebar active state (visible) */
.sidebar.active {
  left: 0;
}

/* Overlay (dark transparent background) */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.4);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 900;
}

/* Overlay visible */
.overlay.active {
  opacity: 1;
  pointer-events: auto;
}


/* Empty Sidebar (hidden by default) */
.sidebar {
  position: fixed;
  top: 0;
  left: -250px;
  width: 220px;
  height: 100%;
  background-color: white;
  box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
  transition: left 0.3s ease;
  z-index: 1001;
}

/* Show sidebar when active */
.sidebar.active {
  left: 0;
}

/* Overlay (optional for effect) */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  background-color: rgba(0,0,0,0.4);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease;
  z-index: 1000;
}

.overlay.active {
  opacity: 1;
  visibility: visible;
}


#applyFilter,
#resetFilter,
button[onclick="window.location.reload();"] {
  height: 50px;
  padding: 0 16px;
  font-size: 14px;
  border-radius: 6px;
  border: none;
  background-color: #005b9f;
  color: white;
  cursor: pointer;
  margin-left: 8px;
  transition: background-color 0.2s ease;
}

#applyFilter:hover,
#resetFilter:hover,
button[onclick="window.location.reload();"]:hover {
  background-color: #004b88;
}




  :root {
    --primary-color: #005A9C;
    --secondary-color: #00A3E0;
    --background-color: #f4f7f9;
    --card-background: #ffffff;
    --text-color: #333333;
    --label-color: #004070;
    --border-color: #dbe2e8;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --font-family: 'Montserrat', sans-serif;
    --border-radius: 12px;
    --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    --transition-speed: 0.3s;
  }

  body {
    font-family: var(--font-family);
    background-color: var(--background-color);
    color: var(--text-color);
    margin: 0;
    padding: 2rem;
    min-height: 100vh;
  }

  h1 {
    text-align: center;
    margin-bottom: 2rem;
    color: var(--primary-color);
    font-size: 2.5rem;
    font-weight: 700;
    position: relative;
    display: inline-block;
    width: 100%;
  }

  h1::after {
    content: '';
    display: block;
    width: 100px;
    height: 4px;
    background: var(--secondary-color);
    margin: 0.5rem auto 0;
    border-radius: 2px;
  }

  /* --- CONTROLS STYLING --- */
  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.5rem;
    margin-bottom: 2.5rem;
    align-items: center;
    background: var(--card-background);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    transition: all var(--transition-speed) ease;
  }

  .controls:hover {
    box-shadow: 0 8px 25px rgba(0, 90, 156, 0.1);
  }

  .controls label {
    display: flex;
    flex-direction: column;
    font-size: 1rem;
    font-weight: 600;
    color: var(--label-color);
    min-width: 180px;
  }

  .controls input[type="date"],
  .controls select {
    padding: 0.8rem 1rem;
    font-family: var(--font-family);
    font-size: 0.95rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #fdfdfd;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
    transition: all var(--transition-speed) ease;
    margin-top: 0.5rem;
  }

  .controls input[type="date"]:focus,
  .controls select:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 3px rgba(0, 163, 224, 0.2);
  }

  .controls button {
    padding: 0.8rem 1.5rem;
    cursor: pointer;
    font-family: var(--font-family);
    font-weight: 600;
    font-size: 0.95rem;
    border: none;
    border-radius: 8px;
    transition: all var(--transition-speed) ease;
    min-width: 120px;
  }

  #applyFilter {
    background-color: var(--primary-color);
    color: white;
  }

  #applyFilter:hover {
    background-color: #004a84;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 90, 156, 0.2);
  }

  #resetFilter, button[onClick="window.location.reload();"] {
    background-color: white;
    color: var(--primary-color);
    border: 1px solid var(--border-color);
  }

  #resetFilter:hover, button[onClick="window.location.reload();"]:hover {
    background-color: #f0f7ff;
    border-color: var(--secondary-color);
    transform: translateY(-2px);
  }

    @keyframes scrollUp {
    0% {
      transform: translateY(0);
    }
    100% {
      transform: translateY(calc(-100% + 250px));
    }
  }
  /* --- CHART CONTAINERS --- */
  .chart-containerClient,
    .chart-containerAge,
      .chart-containerSex,
  .chart-container,
  .chart-containerCC1,
    .chart-containerCC2,
      .chart-containerCC3,
  .chart-containerOffice,
  .chart-container2,
  .services-box,
  .suggestions-box {
    background: var(--card-background);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    padding: 1.5rem;
    transition: all var(--transition-speed) ease;
    position: relative;
  }

  .chart-container0:hover,
   .chart-containerClient:hover,
    .chart-containerAge:hover,
     .chart-containerSex:hover,
  .chart-container:hover,
  .chart-containerCC1:hover,
   .chart-containerCC2:hover,
    .chart-containerCC3:hover,
  .chart-containerOffice:hover,
  .chart-container2:hover,
  .services-box:hover,
  .suggestions-box:hover {
    box-shadow: 0 8px 25px rgba(0, 90, 156, 0.1);
    transform: translateY(-3px);
  }

  .chart-containerClient {
    position: relative;
    bottom: 5px;
    left: 35px;
    height: 400px;
    width: 400px;
    margin-bottom: 1.5rem;
  }
    .chart-containerSex {
    position: relative;
    bottom: 478px;
    left: 502px;
    height: 400px;
    width: 400px;
    margin-bottom: 1.5rem;
  } 
  
  
  
  .chart-containerAge {
    position: relative;
    bottom: 950px;
    left: 970px;
    height: 400px;
    width: 400px;
    margin-bottom: 1.5rem;
  }
 

  .chart-containerOffice {
    width: 1335px;
    position: relative;
    left: 35px;
    height: 350px;
    bottom: 2810px;
    margin-bottom: 1.5rem;
  }

  .chart-container {
    position: relative;
    width: 1350px;
    top: -1015px;
    right: -40px;
    height: 350px;
    margin-bottom: 1.5rem;
  }

  .chart-containerCC1 {
    position: relative;
    top: -70px;
    right: -38px;
     height: 400px;
    width: 400px;
    margin-bottom: 1.5rem;
  }
    .chart-containerCC2 {
    position: relative;
    top: -540px;
    right: -512px;
     height: 400px;
    width: 400px;
    margin-bottom: 1.5rem;
  }
    .chart-containerCC3 {
    position: relative;
    top: -1012px;
    right: -988px;
     height: 400px;
    width: 400px;
    margin-bottom: 1.5rem;
  }

  .chart-container2 {
    width: 1335px;
    position: relative;
    left: 35px;
    height: 350px;
    bottom: 970px;
    margin-bottom: 1.5rem;
  }

  /* --- SERVICES BOX --- */
  .services-box {
 width: 1335px;
  height: 400px;
  background: var(--card-background);
  padding: 2rem;
  border-radius: var(--border-radius);
  box-shadow: var(--card-shadow);
  position: absolute;
  top: 1620px; /* Adjust this value based on exact placement needed */
  left: 4.5%;
  
}


  .services-box h2 {
    margin-top: 0;
    text-align: center;
    color: var(--primary-color);
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    position: relative;
  }

  .services-box h2::after {
    content: '';
    display: block;
    width: 60px;
    height: 3px;
    background: var(--secondary-color);
    margin: 0.5rem auto 0;
    border-radius: 2px;
  }

  /* --- SUGGESTIONS BOX --- */
  .suggestions-box {
  max-height: 500px;
  width: 1350px;
  background: var(--card-background);
  padding: 1.5rem;
  border-radius: var(--border-radius);
  box-shadow: var(--card-shadow);
  margin: 2rem auto;          /* Removed positioning, adds spacing */
  overflow-y: auto;           /* Enables manual scroll */
  position: relative;         /* Resets from absolute */
  bottom: 1450px;
  left: 10px;
}


  .suggestions-box h2 {
    margin-top: 0;
    text-align: center;
    color: var(--primary-color);
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    position: relative;
  }

  .suggestions-box h2::after {
    content: '';
    display: block;
    width: 60px;
    height: 3px;
    background: var(--secondary-color);
    margin: 0.5rem auto 0;
    border-radius: 2px;
  }

  /* --- SCROLL CONTAINERS --- */
  .scroll-container {
    height: 320px;
    overflow: hidden;
    position: relative;
  }

  .scroll-container:hover {
    animation-play-state: paused;
    overflow-y: auto;
    cursor: grab;
  }

  #serviceList {
    position: relative;
  }

  #serviceList.scroll-animate {
    animation: scrollUp 100s linear infinite;
  }



  /* --- LISTS --- */
  .services-box ul,
  .suggestions-box ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }

  .services-box li,
  .suggestions-box li {
    padding: 0.8rem 1rem;
    margin-bottom: 0.5rem;
    background: rgba(0, 163, 224, 0.05);
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .services-box li:hover,
  .suggestions-box li:hover {
    background: rgba(0, 163, 224, 0.1);
    transform: translateX(3px);
  }

  .services-box li strong,
  .suggestions-box li strong {
    color: var(--primary-color);
    display: block;
    margin-bottom: 0.3rem;
  }

  /* --- SCROLLBARS --- */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(0, 90, 156, 0.3);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 90, 156, 0.5);
  }

  /* --- CHART ANIMATIONS --- */
  canvas {
    opacity: 0;
    animation: fadeIn 0.8s ease-out forwards;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- RESPONSIVE DESIGN --- */
  @media (max-width: 1200px) {
    .controls {
      gap: 1rem;
    }
    
    .controls label {
      min-width: 150px;
    }
  }

  @media (max-width: 768px) {
    body {
      padding: 1rem;
    }
    
    h1 {
      font-size: 2rem;
    }
    
    .controls {
      flex-direction: column;
      align-items: stretch;
      gap: 0.8rem;
    }
    
    .controls label {
      min-width: auto;
    }
    
    .controls button {
      width: 100%;
    }
  }
</style>
</head>
<body>
  <!-- Hamburger Only (No Menu Items Yet) -->
<div class="hamburger-container">
  <div class="hamburger" onclick="toggleMenu()">☰</div>
</div>

<!-- Sidebar placeholder for later -->
<div class="sidebar" id="sidebarMenu">
 <ul>
  <li><a href="index.html" onclick="toggleMenu()">📊 Dashboard</a></li>
  <li><a href="page1.html" onclick="toggleMenu()">📁 Reports</a></li>
  <li>
    <a href="https://docs.google.com/spreadsheets/d/1zYSKIqZNEkZXqvXTZJ90WlABxheArCkniGGACAPAGUg/edit?gid=0#gid=0" 
       target="_blank" 
       onclick="toggleMenu()">
      📬 Spreadsheet
    </a>
  </li>
</ul>

</div>



<!-- Optional overlay if you plan to use later -->
<div class="overlay" id="overlay" onclick="toggleMenu()"></div>




  <h1>📊 i-GOV Feedback Dashboard</h1>

  <div class="controls">
    <label>Start Date:
      <input type="date" id="startDate">
    </label>
    <label>End Date:
      <input type="date" id="endDate">
    </label>
    <label>Office:
      <select id="officeSelect">
                            <option value="">-- All Offices --</option>
                            <option value="BICOL CENTRAL STATION">BICOL CENTRAL STATION</option>
                            <option value="BICOL SCIENCE AND TECHNOLOGY CENTRUM">BICOL SCIENCE AND TECHNOLOGY CENTRUM</option>
                            <option value="CITY ACCOUNTING OFFICE">CITY ACCOUNTING OFFICE</option>
                            <option value="CITY AGRICULTURIST OFFICE">CITY AGRICULTURIST OFFICE</option>
                            <option value="CITY ASSESSORS OFFICE">CITY ASSESSORS OFFICE</option>
                            <option value="CITY BUDGET OFFICE">CITY BUDGET OFFICE</option>
                            <option value="CITY CIVIL REGISTRY OFFICE">CITY CIVIL REGISTRY OFFICE</option>
                            <option value="CITY DISASTER RISK REDUCTION MANAGEMENT OFFICE">CITY DISASTER RISK REDUCTION MANAGEMENT OFFICE</option>
                            <option value="CITY ENVIRONMENT AND NATURAL RESOURCES OFFICE">CITY ENVIRONMENT AND NATURAL RESOURCES OFFICE</option>
                            <option value="CITY ENGINEERS OFFICE">CITY ENGINEERS OFFICE</option>
                            <option value="CITY EVENTS PROTOCOL AND PUBLICATION INFORMATION OFFICE">CITY EVENTS PROTOCOL AND PUBLICATION INFORMATION OFFICE</option>
                            <option value="CITY HEALTH OFFICE">CITY HEALTH OFFICE</option>
                            <option value="CITY HUMAN RESOURCE MANAGEMENT OFFICE">CITY HUMAN RESOURCE MANAGEMENT OFFICE</option>
                            <option value="CITY LEGAL OFFICE">CITY LEGAL OFFICE</option>
                            <option value="CITY MAYORS OFFICE">CITY MAYORS OFFICE</option>
                            <option value="CITY MAYORS OFFICE - OFFICE OF THE SENIOR CITIZENS AFFAIRS">CITY MAYORS OFFICE - OFFICE OF THE SENIOR CITIZENS AFFAIRS</option>
                            <option value="CITY MAYORS OFFICE – RESOURCE CENTER FOR THE BLINDS">CITY MAYORS OFFICE – RESOURCE CENTER FOR THE BLINDS</option>
                            <option value="CITY MAYORS OFFICE - WATER SERVICES DIVISION">CITY MAYORS OFFICE - WATER SERVICES DIVISION</option>
                            <option value="CITY PLANNING AND DEVELOPMENT OFFICE">CITY PLANNING AND DEVELOPMENT OFFICE</option>
                            <option value="CITY POPULATION AND NUTRITION OFFICE">CITY POPULATION AND NUTRITION OFFICE</option>
                            <option value="CITY SOCIAL WELFARE AND DEVELOPMENT OFFICE">CITY SOCIAL WELFARE AND DEVELOPMENT OFFICE</option>
                            <option value="CITY TREASURERS OFFICE">CITY TREASURERS OFFICE</option>
                            <option value="CITY VETERINARY OFFICE">CITY VETERINARY OFFICE</option>
                            <option value="EDUCATION SCHOLARSHIP AND SPORTS OFFICE">EDUCATION SCHOLARSHIP AND SPORTS OFFICE</option>
                            <option value="GENERAL SERVICES OFFICE">GENERAL SERVICES OFFICE</option>
                            <option value="HOUSING AND SETTLEMENT OFFICE">HOUSING AND SETTLEMENT OFFICE</option>
                            <option value="INFORMATION TECHNOLOGY OFFICE">INFORMATION TECHNOLOGY OFFICE</option>
                            <option value="LINGKOD BARANGAY OFFICE">LINGKOD BARANGAY OFFICE</option>
                            <option value="MARKET ENTERPRISE PROMOTIONS OFFICE">MARKET ENTERPRISE PROMOTIONS OFFICE</option>
                            <option value="METRO PUBLIC EMPLOYMENT SERVICE OFFICE">METRO PUBLIC EMPLOYMENT SERVICE OFFICE </option>
                            <option value="NAGA CITY ABATTOIR">NAGA CITY ABATTOIR</option>
                            <option value="NAGA CITY HOSPITAL">NAGA CITY HOSPITAL</option>
                            <option value="NAGA CITY INVESTMENT BOARD">NAGA CITY INVESTMENT BOARD</option>
                            <option value="OFFICE OF THE CITY ADMINISTRATOR – ARTS, CULTURE, AND  TOURISM OFFICE">OFFICE OF THE CITY ADMINISTRATOR – ARTS, CULTURE, AND TOURISM OFFICE</option>
                            <option value="OFFICE OF THE CITY ADMINISTRATOR – BUILDING MAINTENANCE OFFICE ">OFFICE OF THE CITY ADMINISTRATOR</option>
                            <option value="OFFICE OF THE CITY ADMINISTRATOR - CITY PARKS AND RECREATIONAL FACILITIES MANAGEMENT OFFICE">OFFICE OF THE CITY ADMINISTRATOR - CITY PARKS AND RECREATIONAL FACILITIES MANAGEMENT OFFICE</option>
                            <option value="OFFICE OF THE CITY ADMINISTRATOR - I-GOVERNANCE OFFICE">OFFICE OF THE CITY ADMINISTRATOR - I-GOVERNANCE OFFICE</option>
                            <option value="OUR LADY OF LOURDES INFIRMARY">OUR LADY OF LOURDES INFIRMARY</option>
                            <option value="PERSONS WITH DISABILTY AFFAIRS OFFICE ">PERSONS WITH DISABILTY AFFAIRS OFFICE</option>
                            <option value="PUBLIC SAFETY OFFICE">PUBLIC SAFETY OFFICE</option>
                            <option value="RAUL S. ROCO LIBRARY / NAGA CITY PUBLIC LIBRARY">RAUL S. ROCO LIBRARY / NAGA CITY PUBLIC LIBRARY</option>
                            <option value="SANGGUNIANG PANLUNGSOD">SANGGUNIANG PANLUNGSOD</option>
                            <option value="SOLID WASTE MANAGEMENT OFFICE">SOLID WASTE MANAGEMENT OFFICE</option>
                          </select>
    </label>
    <button id="applyFilter">Apply Filters</button>
    <button id="resetFilter">Reset Filters</button>
    <button onClick="window.location.reload();">Refresh Data</button>
  </div>

  <div class="charts">
    <div class="chart-containerClient"><canvas id="chartClientType"></canvas></div>
    <div class="chart-containerSex"><canvas id="chartSex"></canvas></div>
    <div class="chart-containerAge"><canvas id="chartAge"></canvas></div><br>
    <div class="chart-container2"><canvas id="chartBarangay"></canvas></div>
    <div class="chart-containerCC1"><canvas id="chartCC1"></canvas></div>
    <div class="chart-containerCC2"><canvas id="chartCC2"></canvas></div>
    <div class="chart-containerCC3"><canvas id="chartCC3"></canvas></div>
    <div class="chart-container"><canvas id="chartSQD"></canvas></div>
    <div class="chart-containerOffice"><canvas id="chartOffice"></canvas></div>
    <div class="suggestions-box" id="suggestionsBox">
  <h2>💬 Suggestions & Comments</h2>
  <div class="scroll-container" id="suggestionScrollContainer">
    <ul id="suggestionList"></ul>
  </div>
</div>

 <div class="services-box" id="servicesBox">
  <h2>📋 Services Availed</h2>
  <div class="scroll-container" id="serviceScrollContainer">
    <ul id="serviceList"></ul>
  </div>
</div>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbwfsDeWwibuh9Zb6ylf72IaBIvNSTeCTm7TSfBRCVk2ftO4gOpbkCbW8RKg3xT19lnZ/exec";
    let dataRaw = [];

    document.getElementById('applyFilter').onclick = renderDashboard;
    document.getElementById('resetFilter').onclick = () => {
      document.getElementById('startDate').value = '';
      document.getElementById('endDate').value = '';
      document.getElementById('officeSelect').value = '';
      renderDashboard();
    };

    async function loadData() {
      const resp = await fetch(endpoint);
      dataRaw = await resp.json();
      renderDashboard();
    }
    
    function isValidDate(d) {
      return d instanceof Date && !isNaN(d);
    }

    function filterByDate(data) {
  const start = document.getElementById('startDate').value;
  const end = document.getElementById('endDate').value;
  const office = document.getElementById('officeSelect').value;

  const startDate = start ? new Date(start) : null;
  const endDate = end ? new Date(end) : null;
  const selectedOffice = office.trim().toLowerCase();

  return data.filter(r => {
    const recordDate = new Date(r['DATE:']);
    if (!isValidDate(recordDate)) return false;

    const recordOffice = (r['OFFICE:'] || '').trim().toLowerCase();

    const dateMatch = (!startDate || recordDate >= startDate) &&
                      (!endDate || recordDate <= endDate);
    const officeMatch = selectedOffice === '' || recordOffice === selectedOffice;

    return dateMatch && officeMatch;
  });
}

    

    function groupBy(arr, key, topN = null) {
      const count = {};
      arr.forEach(r => {
        const v = r[key] || 'Unknown';
        count[v] = (count[v] || 0) + 1;
      });
      let entries = Object.entries(count).map(([k, v]) => ({ k, v }));
      if (topN) entries = entries.sort((a, b) => b.v - a.v).slice(0, topN);
      return entries;
    }

    function renderDashboard() {
      const data = filterByDate(dataRaw);
      const charts = [];

      charts.push({ id: 'chartClientType', type: 'pie', data: groupBy(data, 'CLIENT TYPE:'), title: 'Client Type' });
      charts.push({ id: 'chartSex', type: 'pie', data: groupBy(data, 'SEX:'), title: 'Sex' });
     charts.push({ 
  id: 'chartAge', 
  type: 'bar', 
  data: groupByRange(data, 'AGE:', [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150]), 
  title: 'Age Distribution by Group (0–150+)' 
});

      charts.push({ id: 'chartBarangay', type: 'bar', data: groupBy(data, 'BARANGAY IN NAGA CITY:', 24), title: 'Top Barangays' });
      charts.push({ id: 'chartCC1', type: 'pie', data: groupBy(data, 'CC1:'), title: 'CC1 Awareness' });
      charts.push({ id: 'chartCC2', type: 'bar', data: groupBy(data, 'CC2:'), title: 'CC2 Visibility' });
      charts.push({ id: 'chartCC3', type: 'bar', data: groupBy(data, 'CC3:'), title: 'CC3 Helpfulness' });
      charts.push({ id: 'chartOffice', type: 'bar', data: groupBy(data, 'OFFICE:',56), title: 'OFFICE (as entered)' });

      const sqdKeys = ['SQD0', 'SQD1', 'SQD2', 'SQD3', 'SQD4', 'SQD5', 'SQD6', 'SQD7', 'SQD8'];
      const sqdLevels = ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree', 'Not Applicable'];
      const sqdCounts = {};
      sqdKeys.forEach(k => {
        sqdCounts[k] = {};
        sqdLevels.forEach(l => sqdCounts[k][l] = 0);
      });
      data.forEach(r => {
        sqdKeys.forEach(k => {
          let v = r[k];
          if (sqdCounts[k][v] !== undefined) sqdCounts[k][v]++;
        });
      });
      charts.push({ id: 'chartSQD', type: 'barStacked', data: { keys: sqdKeys, counts: sqdCounts, levels: sqdLevels }, title: 'SQD0–SQD8 Ratings' });

      charts.forEach(cfg => {
        if (Chart.getChart(cfg.id)) Chart.getChart(cfg.id).destroy();
        const ctx = document.getElementById(cfg.id).getContext('2d');
        if (cfg.type === 'barStacked') {
          const labels = cfg.data.keys;
          const datasets = cfg.data.levels.map((lvl, i) => ({
            label: lvl,
            data: labels.map(k => cfg.data.counts[k][lvl]),
            backgroundColor: ['#8B0000', '#E97451', '#D3D3D3', '#FFD700', '#32CD32', '#C0B7D2'][i]
          }));
          new Chart(ctx, {
            type: 'bar',
            data: { labels, datasets },
            options: {
              plugins: { 
                title: { 
                  display: true, 
                  text: cfg.title,
                  font: {
                    size: 16,
                    weight: 'bold'
                  },
                  padding: {
                    top: 10,
                    bottom: 20
                  }
                },
                legend: {
                  position: 'bottom',
                  labels: {
                    padding: 20,
                    usePointStyle: true,
                    pointStyle: 'circle'
                  }
                },
                tooltip: {
                  mode: 'index',
                  intersect: false
                }
              },
              responsive: true,
              maintainAspectRatio: false,
              animation: {
                duration: 1000,
                easing: 'easeOutQuart'
              },
              scales: {
                x: { 
                  stacked: true,
                  grid: {
                    display: false
                  }
                },
                y: { 
                  stacked: true, 
                  beginAtZero: true,
                  grid: {
                    color: 'rgba(0,0,0,0.05)'
                  }
                }
              }
            }
          });
        } else {
          const entries = cfg.data;
          new Chart(ctx, {
            type: cfg.type,
            data: {
              labels: entries.map(e => {
  const label = e.k;

  // Only apply to chartOffice and chartBarangay
  if ((cfg.id === 'chartOffice' || cfg.id === 'chartBarangay'|| cfg.id === 'chartCC2') && label.length > 18) {
    const midpoint = Math.floor(label.length / 2);
    const spaceIndex = label.lastIndexOf(' ', midpoint);
    const splitIndex = spaceIndex > 0 ? spaceIndex : midpoint;
    return [label.slice(0, splitIndex).trim(), label.slice(splitIndex).trim()];

  }

  return label;
}),

              datasets: [{
                data: entries.map(e => e.v),
                backgroundColor: [
                  'rgba(0, 90, 156, 0.7)',
                  'rgba(0, 163, 224, 0.7)',
                  'rgba(70, 130, 180, 0.7)',
                  'rgba(100, 149, 237, 0.7)',
                  'rgba(30, 144, 255, 0.7)',
                  'rgba(0, 191, 255, 0.7)'
                ],
                borderColor: [
                  'rgba(0, 90, 156, 1)',
                  'rgba(0, 163, 224, 1)',
                  'rgba(70, 130, 180, 1)',
                  'rgba(100, 149, 237, 1)',
                  'rgba(30, 144, 255, 1)',
                  'rgba(0, 191, 255, 1)'
                ],
                borderWidth: 1,
                hoverOffset: 10
              }]
            },
            options: {
              plugins: { 
                title: { 
                  display: true, 
                  text: cfg.title,
                  font: {
                    size: 16,
                    weight: 'bold'
                  },
                  padding: {
                    top: 10,
                    bottom: 20
                  }
                },
                legend: {
                  position: 'bottom',
                  labels: {
                    padding: 20,
                    usePointStyle: true,
                    pointStyle: 'circle'
                  }
                }
              },
              responsive: true,
              maintainAspectRatio: false,
              animation: {
                duration: 1000,
                easing: 'easeOutQuart'
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: {
                    color: 'rgba(0,0,0,0.05)'
                  }
                },
                x: {
                  grid: {
                    display: false
                  }
                }
              },
              elements: {
                arc: {
                  borderWidth: 0
                }
              }
            }
          });
        }
      });

      const suggestionList = document.getElementById('suggestionList');
     suggestionList.innerHTML = '';

data.forEach(r => {
  const suggestion = r['SUGGESTIONS/COMMENTS:'] || r['Suggestions'] || '';
  const office = r['OFFICE:'] || 'Unknown Office';
  const date = formatPrettyDate(r['DATE:']);
  const email = r['EMAIL ADDRESS:'] || r['EMAIL'] || 'N/A';

if (suggestion.trim()) {
    const li = document.createElement('li');
    li.innerHTML = `<strong>${office}</strong><small>${date}</small><p>${suggestion}</p><small style="color:#555;">-${email}</small>`;
    suggestionList.appendChild(li);
  }
});
const suggestionItems = suggestionList.querySelectorAll('li');
const totalSuggestionHeight = Array.from(suggestionItems).reduce((acc, li) => acc + li.offsetHeight + 10, 0);

if (totalSuggestionHeight > 250) {
  suggestionList.classList.add('scroll-animate');
} else {
  suggestionList.classList.remove('scroll-animate');
}


    
      const serviceList = document.getElementById('serviceList');
      serviceList.innerHTML = '';

      const services = data.map(r => {
        const office = r['OFFICE:'] || '';
        const service = r['SERVICE AVAILED:'] || '';
        const date = formatPrettyDate(r['DATE:']);
        if ((office || service) && date) {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${office}</strong><br><small>${date}</small><br>${service}`;
          return li;
        }
        return null;
      }).filter(item => item);

      services.forEach(li => serviceList.appendChild(li));

      const totalHeight = services.reduce((acc, li) => acc + li.offsetHeight + 10, 0);
      
      if (totalHeight > 250) {
        serviceList.classList.add('scroll-animate');
      } else {
        serviceList.classList.remove('scroll-animate');
      }
    }
    
    
    function formatPrettyDate(dateString) {
      const options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      };
      return new Date(dateString).toLocaleDateString('en-US', options);
    }

    loadData();
    function groupByRange(arr, key, ranges) {
  const result = {};
  arr.forEach(r => {
    const age = parseInt(r[key]);
    if (!isNaN(age) && age >= 0) {
      for (let i = 0; i < ranges.length - 1; i++) {
        const label = `${ranges[i]}–${ranges[i + 1] - 1}`;
        if (age >= ranges[i] && age < ranges[i + 1]) {
          result[label] = (result[label] || 0) + 1;
          return;
        }
      }
      const lastLabel = `${ranges[ranges.length - 1]}+`;
      result[lastLabel] = (result[lastLabel] || 0) + 1;
    }
  });
  return Object.entries(result).map(([k, v]) => ({ k, v }));
}

function toggleMenu() {
  const sidebar = document.getElementById('sidebarMenu');
  const overlay = document.getElementById('overlay');

  sidebar.classList.toggle('active');
  overlay.classList.toggle('active');
}


  </script>
</body>
</html>